var Flexio = require('./src/main.js')

//Flexio.setup('xtdkxpcjwzkpgkhkcmhx', { baseUrl: 'https://www.flex.io/api/v1' })
Flexio.setup('xtdkxpcjwzkpgkhkcmhx', {debug: true})
Flexio.setup('xtdkxpcjwzkpgkhkcmhx', { baseUrl: 'https://localhost/api/v1', debug: true, insecure: true })


var mypipe = Flexio.pipe()
    .set('files1', Flexio.pipe().list("/my-dropbox/foo"))
    .set('files2', Flexio.pipe().list("/my-s3/bar"))
    .foreach(Flexio.pipe()
    .merge('context://var/files1', 'context://var/files2'))

var json = mypipe.getJSON()
console.log(JSON.stringify(json))




/*
var obj = Flexio.task.convert({ format: 'delimited' } , 'table')
console.log(JSON.stringify(obj));
console.log(Flexio.task.convert.toCode(obj));
*/

/*
var obj = Flexio.task
  .filter("a=1")
  console.log(JSON.stringify(obj));
  console.log(Flexio.task.filter.toCode(obj));
*/

/*
var obj = Flexio.task.copy('a','b', {a:1})
console.log(JSON.stringify(obj));
console.log(Flexio.task.copy.toCode(obj));
*/


/*
var obj = Flexio.task.foreach('myspec',Flexio.pipe().echo("HELLO"))
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/

/*
var obj = Flexio.task.email({
    "to": [
      "ben@flex.io"
    ],
    "subject": "Chicago Crime Data Refreshed",
    "body_html": "The data for the Chicago Crime App has been refreshed."
  })
  
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/

/*
var obj = Flexio.task.render('http://www.flex.io', { format: 'jpeg' })
  
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/


/*
var obj = Flexio.task.convert('tsv', 'csv')
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/


/*
var obj = Flexio.task.request('http://www.flex.io', { 'method': 'POST' } )
  
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/

/*
var obj = Flexio.task.execute('javascript', 'abc()')
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/


/*
obj = Flexio.task.javascript(function(context) { a = 1 })
console.log(JSON.stringify(obj));
console.log(Flexio.task.toCode(obj, Flexio));
*/

/*

var mypipe = Flexio.pipe()
.set('files1', Flexio.pipe().list("/my-dropbox/foo"))
.set('files2', Flexio.pipe().list("/my-s3/bar"))
.foreach(Flexio.pipe()
.merge('context://var/files1', 'context://var/files2'))
console.log(JSON.stringify(mypipe.pipe.task))



mypipe = Flexio.pipe({op:"sequence",params:{items:[{op:"echo",params:{"msg":"Hello"}}]}})

console.log(mypipe.toCode())
*/


//console.log(mycode.toCode())


/*
var obj = Flexio.task.set('a', Flexio.pipe().echo('hello'))
console.log(JSON.stringify(obj))
console.log(Flexio.task.set.toCode(obj));
*/

/*
var obj = Flexio.task.insert("file", [{name:"abc"},{name:"abc"}])
console.log(JSON.stringify(obj));
console.log(Flexio.task.insert.toCode(obj));
*/

/*
Flexio.pipe()
  .task({"type": "flexio.echo",
         "params": { "msg": "Hello, World"}})
  .run(function(err, response) {
         console.log(response.text)
  })
*/

/*
var pipe = new Flexio.pipe()
pipe.echo("Hello1")
pipe.echo("Hello2")
pipe.echo("Hello3")

var pipe = {
    "name": "Flexio Website",
    "ename": "my-custom-pipe-alias",
    "description": "Flex.io Website",
    "task": [
        {
            "type": "flexio.request",
            "params": {
                "url": "https://www.flex.io"
            }
        }
    ]
}

Flexio.pipes.create(pipe, function (err, response) {
    console.log(err)
    console.log(response)
})*/



/*
var conn = {
    "name": "HTTP Connection",
    "description": "HTTP Connection to API",
    "connection_type": "http",
    "connection_info": {
        "url": "https://api.service.com/endpoint",
        "headers": {
            "Authorization": "Bearer :token",
            "Content-Type": "application/json"
        }
    }
}
*/

/*
var conn = Flexio.connection()
conn.name("Hello")
    .description("This is a test description")

Flexio.connections.create(conn, function (err, response) {
    console.log(err)
    console.log(response)
})
*/


/*
var pipe = Flexio.pipe()
    .javascript(function(context) {
        context.output.write('Hello World! ' + context.query.name)
      })
.run({ query: { name:"Ben"} }, function(err, response) {
    console.log(response.text)
})

Flexio.pipes.run(pipe, { query: { name:"Ben"} }, function(err, response) {
    console.log(response.text)
})

*/

/*
var pipe = Flexio.pipe('hello-world').run(function(err, response) {
    console.log(response.text)
})

var pipe = Flexio.pipes.run('hello-world', function(err, response) {
    console.log(response.text)
})
*/
